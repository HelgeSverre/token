---
import SiteLayout from '../layouts/SiteLayout.astro';
import { themes } from '../data/themes';

const codePreview = `<span class="kw">use</span> <span class="ty">std</span><span class="pn">::</span><span class="ty">collections</span><span class="pn">::</span><span class="ty">HashMap</span><span class="pn">;</span>

<span class="cm">/// A configuration manager</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ty">Config</span> <span class="pn">{</span>
    <span class="vr">values</span><span class="pn">:</span> <span class="ty">HashMap</span><span class="pn">&lt;</span><span class="ty">String</span><span class="pn">,</span> <span class="ty">String</span><span class="pn">&gt;,</span>
    <span class="vr">readonly</span><span class="pn">:</span> <span class="ty">bool</span><span class="pn">,</span>
<span class="pn">}</span>

<span class="kw">impl</span> <span class="ty">Config</span> <span class="pn">{</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="fn">new</span><span class="pn">()</span> <span class="op">-&gt;</span> <span class="ty">Self</span> <span class="pn">{</span>
        <span class="ty">Self</span> <span class="pn">{</span>
            <span class="vr">values</span><span class="pn">:</span> <span class="ty">HashMap</span><span class="pn">::</span><span class="fn">new</span><span class="pn">(),</span>
            <span class="vr">readonly</span><span class="pn">:</span> <span class="ct">false</span><span class="pn">,</span>
        <span class="pn">}</span>
    <span class="pn">}</span>

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="fn">get</span><span class="pn">(</span><span class="op">&amp;</span><span class="kw">self</span><span class="pn">,</span> <span class="vr">key</span><span class="pn">:</span> <span class="op">&amp;</span><span class="ty">str</span><span class="pn">)</span> <span class="op">-&gt;</span> <span class="ty">Option</span><span class="pn">&lt;&amp;</span><span class="ty">String</span><span class="pn">&gt;</span> <span class="pn">{</span>
        <span class="kw">self</span><span class="pn">.</span><span class="vr">values</span><span class="pn">.</span><span class="fn">get</span><span class="pn">(</span><span class="vr">key</span><span class="pn">)</span> <span class="cm">// lookup</span>
    <span class="pn">}</span>
<span class="pn">}</span>

<span class="kw">fn</span> <span class="fn">main</span><span class="pn">()</span> <span class="pn">{</span>
    <span class="kw">let</span> <span class="vr">config</span> <span class="op">=</span> <span class="ty">Config</span><span class="pn">::</span><span class="fn">new</span><span class="pn">();</span>
    <span class="kw">let</span> <span class="vr">count</span><span class="pn">:</span> <span class="ty">u32</span> <span class="op">=</span> <span class="nm">42</span><span class="pn">;</span>
    <span class="fn">println!</span><span class="pn">(</span><span class="st">"Ready: {}"</span><span class="pn">,</span> <span class="vr">count</span><span class="pn">);</span>
<span class="pn">}</span>`;
---

<SiteLayout title="Themes — Token" description="Browse and preview color themes for Token editor.">

<section class="themes-page">
  <div class="ide-frame">

    <!-- Toolbar -->
    <div class="toolbar">
      <span class="toolbar-title" id="toolbar-title">themes/{themes[0].fileName}</span>
      <span class="toolbar-count">{themes.length} themes</span>
    </div>

    <div class="ide-body">

      <!-- Sidebar -->
      <aside class="sidebar">
        {themes.map((theme, i) => (
          <button
            class={`sidebar-file ${i === 0 ? 'active' : ''}`}
            data-theme-id={theme.id}
          >
            <svg class="file-icon" width="14" height="14" viewBox="0 0 16 16" fill="none">
              <rect x="2" y="1" width="12" height="14" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
              <path d="M5 5h6M5 8h6M5 11h3" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
            </svg>
            <span class="file-name">{theme.fileName}</span>
          </button>
        ))}

        <!-- Custom theme entry (hidden until edit mode) -->
        <button
          class="sidebar-file sidebar-custom"
          data-theme-id="custom"
          style="display:none"
        >
          <svg class="file-icon" width="14" height="14" viewBox="0 0 16 16" fill="none">
            <rect x="2" y="1" width="12" height="14" rx="1.5" stroke="currentColor" stroke-width="1.2"/>
            <path d="M5 5h6M5 8h6M5 11h3" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
          </svg>
          <span class="file-name">custom-theme.yaml</span>
        </button>

        <div class="sidebar-spacer"></div>

        <!-- New theme button -->
        <button class="sidebar-new-theme" id="btn-new-theme">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
            <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>New Theme</span>
        </button>
      </aside>

      <!-- Splitter between sidebar and editor -->
      <div class="splitter"></div>

      <!-- Editor area (tab bar + editor pane) -->
      <div class="editor-area">

        <!-- Tab bar -->
        <div class="tab-bar">
          <div class="tab active" data-tab="code">
            <span class="tab-name">main.rs</span>
          </div>
          <div class="tab" data-tab="code">
            <span class="tab-name">config.rs</span>
            <span class="tab-modified">●</span>
          </div>
          <div class="tab" data-tab="code">
            <span class="tab-name">lib.rs</span>
          </div>
          <div class="tab" data-tab="yaml" id="tab-yaml">
            <span class="tab-name">theme.yaml</span>
          </div>
        </div>

        <!-- Editor pane (code preview) -->
        <div class="editor-pane" id="editor-pane">
          <div class="editor-gutter">
            {Array.from({ length: 28 }, (_, i) => (
              <span class={`line-num ${i === 17 ? 'active' : ''}`} data-line={i + 1}>{i + 1}</span>
            ))}
          </div>
          <div class="editor-gutter-border"></div>
          <div class="editor-code-wrap">
            <pre class="editor-code"><code set:html={codePreview} /></pre>
            <div class="editor-cursor"></div>
          </div>
        </div>

        <!-- Editor pane (YAML view) -->
        <div class="editor-pane editor-pane-yaml" id="editor-pane-yaml" style="display:none">
          <div class="editor-gutter" id="yaml-gutter"></div>
          <div class="editor-gutter-border"></div>
          <div class="editor-code-wrap">
            <pre class="editor-code editor-code-yaml" id="yaml-content"></pre>
          </div>
        </div>

      </div>

      <!-- Detail pane -->
      <aside class="detail-pane" id="detail-pane">
        <div class="detail-header">
          <h2 class="detail-name detail-readonly" id="detail-name">{themes[0].name}</h2>
          <input class="detail-name-input detail-editable" id="detail-name-input"
            type="text" value={themes[0].name} placeholder="Theme name" />
          <span class="detail-badge" id="detail-badge">{themes[0].isLight ? 'light' : 'dark'}</span>
        </div>
        <input class="detail-author-input detail-editable" id="detail-author-input"
          type="text" value="You" placeholder="Author name" />
        <p class="detail-author detail-readonly" id="detail-author">by {themes[0].author}</p>
        <p class="detail-desc detail-readonly" id="detail-desc">{themes[0].description}</p>

        <div class="detail-base-theme detail-editable">
          <label class="detail-label" for="base-theme-select">Based on</label>
          <select id="base-theme-select" class="detail-select">
            {themes.map((t) => (
              <option value={t.id}>{t.name}</option>
            ))}
          </select>
        </div>

        <div class="swatch-section">
          <h3 class="swatch-heading">Editor</h3>
          <div class="swatch-grid" id="swatches-editor">
            {Object.entries({
              bg: themes[0].colors.bg,
              fg: themes[0].colors.fg,
              cursor: themes[0].colors.cursor,
              selection: themes[0].colors.selection,
              currentLine: themes[0].colors.currentLine,
            }).map(([key, val]) => (
              <div class="swatch-row" data-color-key={key}>
                <label class="swatch-dot-label">
                  <span class="swatch-dot" style={`background:${val}`}></span>
                  <input type="color" class="swatch-color-input" value={val.substring(0, 7)} tabindex="-1" />
                </label>
                <span class="swatch-label">{key}</span>
                <span class="swatch-hex detail-readonly">{val}</span>
                <input type="text" class="swatch-hex-input detail-editable" value={val}
                  spellcheck="false" />
              </div>
            ))}
          </div>
        </div>

        <div class="swatch-section">
          <h3 class="swatch-heading">Chrome</h3>
          <div class="swatch-grid" id="swatches-chrome">
            {Object.entries({
              gutterBg: themes[0].colors.gutterBg,
              gutterFg: themes[0].colors.gutterFg,
              gutterFgActive: themes[0].colors.gutterFgActive,
              gutterBorder: themes[0].colors.gutterBorder,
              sidebarBg: themes[0].colors.sidebarBg,
              statusBg: themes[0].colors.statusBg,
              statusFg: themes[0].colors.statusFg,
              tabBarBg: themes[0].colors.tabBarBg,
              tabBarActiveBg: themes[0].colors.tabBarActiveBg,
              tabBarActiveFg: themes[0].colors.tabBarActiveFg,
              tabBarInactiveFg: themes[0].colors.tabBarInactiveFg,
              tabBarBorder: themes[0].colors.tabBarBorder,
              splitterBg: themes[0].colors.splitterBg,
            }).map(([key, val]) => (
              <div class="swatch-row" data-color-key={key}>
                <label class="swatch-dot-label">
                  <span class="swatch-dot" style={`background:${val}`}></span>
                  <input type="color" class="swatch-color-input" value={val.substring(0, 7)} tabindex="-1" />
                </label>
                <span class="swatch-label">{key}</span>
                <span class="swatch-hex detail-readonly">{val}</span>
                <input type="text" class="swatch-hex-input detail-editable" value={val}
                  spellcheck="false" />
              </div>
            ))}
          </div>
        </div>

        <div class="swatch-section">
          <h3 class="swatch-heading">Syntax</h3>
          <div class="swatch-grid" id="swatches-syntax">
            {Object.entries({
              keyword: themes[0].colors.keyword,
              function: themes[0].colors.function,
              string: themes[0].colors.string,
              number: themes[0].colors.number,
              comment: themes[0].colors.comment,
              type: themes[0].colors.type,
              variable: themes[0].colors.variable,
              operator: themes[0].colors.operator,
              punctuation: themes[0].colors.punctuation,
              constant: themes[0].colors.constant,
              tag: themes[0].colors.tag,
              attribute: themes[0].colors.attribute,
            }).map(([key, val]) => (
              <div class="swatch-row" data-color-key={key}>
                <label class="swatch-dot-label">
                  <span class="swatch-dot" style={`background:${val}`}></span>
                  <input type="color" class="swatch-color-input" value={val.substring(0, 7)} tabindex="-1" />
                </label>
                <span class="swatch-label">{key}</span>
                <span class="swatch-hex detail-readonly">{val}</span>
                <input type="text" class="swatch-hex-input detail-editable" value={val}
                  spellcheck="false" />
              </div>
            ))}
          </div>
        </div>

        <div class="detail-actions detail-editable">
          <button class="btn-download" id="btn-download-yaml">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <path d="M8 2v9M4 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 13h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Download YAML
          </button>
          <button class="btn-exit-edit" id="btn-exit-edit">
            ✕ Exit
          </button>
        </div>
      </aside>

    </div>

    <!-- Status bar -->
    <div class="statusbar">
      <div class="statusbar-left">
        <span id="status-name">{themes[0].name}</span>
      </div>
      <div class="statusbar-right">
        <span id="status-cursor">Ln 18, Col 39</span>
        <span class="statusbar-sep"></span>
        <span id="status-lines">30 Ln</span>
      </div>
    </div>

  </div>
</section>

</SiteLayout>

<div id="theme-data" data-themes={JSON.stringify(themes)} style="display:none"></div>

<div class="drop-overlay" id="drop-overlay">
  <div class="drop-overlay-content">
    <svg width="32" height="32" viewBox="0 0 16 16" fill="none">
      <path d="M8 10V2M4 6l4-4 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M2 13h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <span>Drop theme YAML to import</span>
  </div>
</div>

<script>
  import YAML from 'yaml';

  // Bidirectional mapping: flat ThemeData color key → YAML nested path
  const COLOR_MAP: Record<string, string> = {
    bg: 'ui.editor.background',
    fg: 'ui.editor.foreground',
    currentLine: 'ui.editor.current_line_background',
    cursor: 'ui.editor.cursor_color',
    selection: 'ui.editor.selection_background',
    gutterBg: 'ui.gutter.background',
    gutterFg: 'ui.gutter.foreground',
    gutterFgActive: 'ui.gutter.foreground_active',
    gutterBorder: 'ui.gutter.border_color',
    sidebarBg: 'ui.sidebar.background',
    statusBg: 'ui.status_bar.background',
    statusFg: 'ui.status_bar.foreground',
    tabBarBg: 'ui.tab_bar.background',
    tabBarActiveBg: 'ui.tab_bar.active_background',
    tabBarActiveFg: 'ui.tab_bar.active_foreground',
    tabBarInactiveBg: 'ui.tab_bar.inactive_background',
    tabBarInactiveFg: 'ui.tab_bar.inactive_foreground',
    tabBarBorder: 'ui.tab_bar.border',
    splitterBg: 'ui.sidebar.border',
    keyword: 'ui.syntax.keyword',
    function: 'ui.syntax.function',
    string: 'ui.syntax.string',
    number: 'ui.syntax.number',
    comment: 'ui.syntax.comment',
    type: 'ui.syntax.type',
    variable: 'ui.syntax.variable',
    operator: 'ui.syntax.operator',
    punctuation: 'ui.syntax.punctuation',
    constant: 'ui.syntax.constant',
    tag: 'ui.syntax.tag',
    attribute: 'ui.syntax.attribute',
  };

  function getAtPath(obj: any, path: string): string | undefined {
    return path.split('.').reduce((o, k) => o?.[k], obj);
  }

  function setAtPath(obj: any, path: string, value: string): void {
    const keys = path.split('.');
    let current = obj;
    for (let i = 0; i < keys.length - 1; i++) {
      if (!current[keys[i]]) current[keys[i]] = {};
      current = current[keys[i]];
    }
    current[keys[keys.length - 1]] = value;
  }

  function flatColorsFromYaml(yamlObj: any): Record<string, string> {
    const colors: Record<string, string> = {};
    for (const [flatKey, yamlPath] of Object.entries(COLOR_MAP)) {
      const val = getAtPath(yamlObj, yamlPath);
      if (val) colors[flatKey] = val;
    }
    return colors;
  }

  function buildYamlObject(
    baseYaml: any,
    flatColors: Record<string, string>,
    meta: { name: string; author: string; description: string }
  ): any {
    const obj = JSON.parse(JSON.stringify(baseYaml));
    obj.name = meta.name;
    obj.author = meta.author;
    obj.description = meta.description;
    for (const [flatKey, yamlPath] of Object.entries(COLOR_MAP)) {
      if (flatColors[flatKey]) {
        setAtPath(obj, yamlPath, flatColors[flatKey]);
      }
    }
    return obj;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const dataEl = document.getElementById('theme-data');
    const themes = JSON.parse(dataEl?.getAttribute('data-themes') || '[]');
    const buttons = document.querySelectorAll<HTMLButtonElement>('.sidebar-file');
    const detailName = document.getElementById('detail-name')!;
    const detailBadge = document.getElementById('detail-badge')!;
    const detailAuthor = document.getElementById('detail-author')!;
    const detailDesc = document.getElementById('detail-desc')!;
    const statusName = document.getElementById('status-name')!;
    const swatchesEditor = document.getElementById('swatches-editor')!;
    const swatchesChrome = document.getElementById('swatches-chrome')!;
    const swatchesSyntax = document.getElementById('swatches-syntax')!;

    const ideFrame = document.querySelector('.ide-frame') as HTMLElement;
    let currentTheme: any = themes[0];

    function applyTheme(theme: any) {
      const c = theme.colors;

      // Set all CSS custom properties on the IDE frame
      const el = ideFrame;
      const props: Record<string, string> = {
        '--theme-bg': c.bg,
        '--theme-fg': c.fg,
        '--theme-current-line': c.currentLine,
        '--theme-cursor': c.cursor,
        '--theme-selection': c.selection,
        '--theme-gutter-bg': c.gutterBg,
        '--theme-gutter-fg': c.gutterFg,
        '--theme-gutter-fg-active': c.gutterFgActive,
        '--theme-gutter-border': c.gutterBorder,
        '--theme-sidebar-bg': c.sidebarBg,
        '--theme-status-bg': c.statusBg,
        '--theme-status-fg': c.statusFg,
        '--theme-tab-bar-bg': c.tabBarBg,
        '--theme-tab-bar-active-bg': c.tabBarActiveBg,
        '--theme-tab-bar-active-fg': c.tabBarActiveFg,
        '--theme-tab-bar-inactive-bg': c.tabBarInactiveBg,
        '--theme-tab-bar-inactive-fg': c.tabBarInactiveFg,
        '--theme-tab-bar-border': c.tabBarBorder,
        '--theme-splitter-bg': c.splitterBg,
        '--theme-keyword': c.keyword,
        '--theme-function': c.function,
        '--theme-string': c.string,
        '--theme-number': c.number,
        '--theme-comment': c.comment,
        '--theme-type': c.type,
        '--theme-variable': c.variable,
        '--theme-operator': c.operator,
        '--theme-punctuation': c.punctuation,
        '--theme-constant': c.constant,
        '--theme-tag': c.tag,
        '--theme-attribute': c.attribute,
      };
      for (const [prop, val] of Object.entries(props)) {
        el.style.setProperty(prop, val);
      }

      // Update detail pane
      detailName.textContent = theme.name;
      detailBadge.textContent = theme.isLight ? 'light' : 'dark';
      detailAuthor.textContent = `by ${theme.author}`;
      detailDesc.textContent = theme.description;

      // Update status bar and toolbar
      statusName.textContent = theme.name;
      document.getElementById('toolbar-title')!.textContent = `themes/${theme.fileName}`;

      // Update swatches
      function updateSwatches(container: HTMLElement) {
        const rows = container.querySelectorAll('.swatch-row');
        rows.forEach((row) => {
          const key = (row as HTMLElement).dataset.colorKey;
          if (key && key in c) {
            const dot = row.querySelector('.swatch-dot') as HTMLElement;
            const hex = row.querySelector('.swatch-hex') as HTMLElement;
            dot.style.background = c[key];
            hex.textContent = c[key];
          }
        });
      }

      updateSwatches(swatchesEditor);
      updateSwatches(swatchesChrome);
      updateSwatches(swatchesSyntax);

      // Update active sidebar
      buttons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.themeId === theme.id);
      });

      // Track current theme for YAML view
      currentTheme = theme;
      if (activeView === 'yaml') updateYamlContent();
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.dataset.themeId === 'custom') return;
        const theme = themes.find((t: any) => t.id === btn.dataset.themeId);
        if (theme) {
          if (editMode) exitEditMode();
          applyTheme(theme);
        }
      });
    });

    // ── YAML tab view ──────────────────────────────────────
    const editorPaneCode = document.getElementById('editor-pane')!;
    const editorPaneYaml = document.getElementById('editor-pane-yaml')!;
    const yamlGutter = document.getElementById('yaml-gutter')!;
    const yamlContent = document.getElementById('yaml-content')!;
    const tabs = document.querySelectorAll<HTMLElement>('.tab-bar .tab');
    let activeView: 'code' | 'yaml' = 'code';

    function showYamlView() {
      activeView = 'yaml';
      editorPaneCode.style.display = 'none';
      editorPaneYaml.style.display = 'flex';
      tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === 'yaml'));
      updateYamlContent();
    }

    function showCodeView() {
      activeView = 'code';
      editorPaneCode.style.display = 'flex';
      editorPaneYaml.style.display = 'none';
      // Re-activate first code tab
      tabs.forEach(t => t.classList.remove('active'));
      tabs[0]?.classList.add('active');
    }

    function updateYamlContent() {
      const yamlStr = currentTheme.yaml || '';
      const lines = yamlStr.split('\n');

      // Build gutter
      yamlGutter.innerHTML = lines
        .map((_: string, i: number) => `<span class="line-num">${i + 1}</span>`)
        .join('');

      // Build syntax-highlighted YAML
      yamlContent.innerHTML = lines
        .map((line: string) => highlightYamlLine(line))
        .join('\n');
    }

    function highlightYamlLine(line: string): string {
      // Comment lines
      if (line.trimStart().startsWith('#')) {
        return `<span class="cm">${escapeHtml(line)}</span>`;
      }
      // Key-value lines
      const match = line.match(/^(\s*)([\w_]+)(:)(.*)/);
      if (match) {
        const [, indent, key, colon, rest] = match;
        let valuePart = '';
        const trimmed = rest.trim();
        if (trimmed.startsWith('"') || trimmed.startsWith("'")) {
          valuePart = ` <span class="st">${escapeHtml(trimmed)}</span>`;
        } else if (/^\d+$/.test(trimmed)) {
          valuePart = ` <span class="nm">${escapeHtml(trimmed)}</span>`;
        } else if (trimmed) {
          valuePart = ` <span class="vr">${escapeHtml(trimmed)}</span>`;
        }
        return `${escapeHtml(indent)}<span class="kw">${escapeHtml(key)}</span><span class="pn">${escapeHtml(colon)}</span>${valuePart}`;
      }
      return escapeHtml(line);
    }

    function escapeHtml(s: string): string {
      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    // Tab click handlers
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        if (tab.dataset.tab === 'yaml') {
          showYamlView();
        } else {
          showCodeView();
        }
      });
    });

    // ── Edit mode state ──────────────────────────────────
    let editMode = false;
    let customColors: Record<string, string> = {};
    let baseThemeId = themes[0].id;

    const btnNewTheme = document.getElementById('btn-new-theme')!;
    const btnDownload = document.getElementById('btn-download-yaml')!;
    const btnExitEdit = document.getElementById('btn-exit-edit')!;
    const baseThemeSelect = document.getElementById('base-theme-select') as HTMLSelectElement;
    const nameInput = document.getElementById('detail-name-input') as HTMLInputElement;
    const authorInput = document.getElementById('detail-author-input') as HTMLInputElement;
    const customSidebarBtn = document.querySelector('.sidebar-custom') as HTMLButtonElement;

    function isLightTheme(bg: string): boolean {
      const hex = bg.replace('#', '');
      const r = parseInt(hex.substring(0, 2), 16);
      const g = parseInt(hex.substring(2, 4), 16);
      const b = parseInt(hex.substring(4, 6), 16);
      return (r * 299 + g * 587 + b * 114) / 1000 > 128;
    }

    function applyCustomTheme() {
      const base = themes.find((t: any) => t.id === baseThemeId) || themes[0];
      const baseYamlObj = YAML.parse(base.yaml);
      const yamlObj = buildYamlObject(baseYamlObj, customColors, {
        name: nameInput.value || 'Custom Theme',
        author: authorInput.value || 'Unknown',
        description: '',
      });
      const customTheme = {
        id: 'custom',
        name: nameInput.value,
        author: authorInput.value,
        description: '',
        fileName: 'custom-theme.yaml',
        isLight: isLightTheme(customColors.bg || '#1E1E1E'),
        colors: customColors,
        yaml: YAML.stringify(yamlObj, { indent: 2, lineWidth: 0 }),
      };
      applyTheme(customTheme);
    }

    function updateAllSwatchInputs() {
      [swatchesEditor, swatchesChrome, swatchesSyntax].forEach(container => {
        container.querySelectorAll('.swatch-row').forEach(row => {
          const key = (row as HTMLElement).dataset.colorKey;
          if (!key || !(key in customColors)) return;
          const val = customColors[key];
          const dot = row.querySelector('.swatch-dot') as HTMLElement;
          const hex = row.querySelector('.swatch-hex') as HTMLElement;
          const hexInput = row.querySelector('.swatch-hex-input') as HTMLInputElement;
          const colorInput = row.querySelector('.swatch-color-input') as HTMLInputElement;
          if (dot) dot.style.background = val;
          if (hex) hex.textContent = val;
          if (hexInput) hexInput.value = val;
          if (colorInput) colorInput.value = val.substring(0, 7);
        });
      });
    }

    function enterEditMode(fromThemeId?: string) {
      const base = themes.find((t: any) => t.id === (fromThemeId || baseThemeId)) || themes[0];
      baseThemeId = base.id;
      customColors = { ...base.colors };
      baseThemeSelect.value = base.id;
      nameInput.value = 'My Custom Theme';
      authorInput.value = 'You';

      editMode = true;
      ideFrame.classList.add('is-editing');

      buttons.forEach(b => b.classList.remove('active'));
      customSidebarBtn.classList.add('active');

      updateAllSwatchInputs();
      applyCustomTheme();
    }

    function exitEditMode() {
      editMode = false;
      ideFrame.classList.remove('is-editing');
      customSidebarBtn.classList.remove('active');

      const fallback = themes.find((t: any) => t.id === baseThemeId) || themes[0];
      applyTheme(fallback);
    }

    // New Theme button
    btnNewTheme.addEventListener('click', () => {
      const activeBtn = document.querySelector('.sidebar-file.active') as HTMLElement;
      const activeId = activeBtn?.dataset.themeId || themes[0].id;
      enterEditMode(activeId);
    });

    // Exit edit mode
    btnExitEdit.addEventListener('click', exitEditMode);

    // Base theme dropdown
    baseThemeSelect.addEventListener('change', () => {
      const newBase = themes.find((t: any) => t.id === baseThemeSelect.value);
      if (newBase) {
        baseThemeId = newBase.id;
        customColors = { ...newBase.colors };
        updateAllSwatchInputs();
        applyCustomTheme();
      }
    });

    // Color picker and hex input events (delegation on detail pane)
    const detailPane = document.getElementById('detail-pane')!;

    detailPane.addEventListener('input', (e) => {
      if (!editMode) return;
      const target = e.target as HTMLInputElement;

      if (target.classList.contains('swatch-color-input')) {
        const row = target.closest('.swatch-row') as HTMLElement;
        const key = row?.dataset.colorKey;
        if (!key) return;

        const existing = customColors[key] || '';
        const alpha = existing.length === 9 ? existing.substring(7) : '';
        customColors[key] = target.value + alpha;

        const dot = row.querySelector('.swatch-dot') as HTMLElement;
        const hexInput = row.querySelector('.swatch-hex-input') as HTMLInputElement;
        const hexText = row.querySelector('.swatch-hex') as HTMLElement;
        if (dot) dot.style.background = customColors[key];
        if (hexInput) hexInput.value = customColors[key];
        if (hexText) hexText.textContent = customColors[key];

        applyCustomTheme();
      }

      if (target.classList.contains('swatch-hex-input')) {
        const row = target.closest('.swatch-row') as HTMLElement;
        const key = row?.dataset.colorKey;
        if (!key) return;

        const val = target.value.trim();
        if (/^#[0-9a-fA-F]{6,8}$/.test(val)) {
          customColors[key] = val;
          const dot = row.querySelector('.swatch-dot') as HTMLElement;
          const colorInput = row.querySelector('.swatch-color-input') as HTMLInputElement;
          if (dot) dot.style.background = val;
          if (colorInput) colorInput.value = val.substring(0, 7);
          applyCustomTheme();
        }
      }
    });

    // Name/author input triggers live update
    nameInput.addEventListener('input', () => {
      if (editMode) applyCustomTheme();
    });

    // ── YAML download ────────────────────────────────────
    function slugify(s: string): string {
      return s.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    }

    btnDownload.addEventListener('click', () => {
      const base = themes.find((t: any) => t.id === baseThemeId) || themes[0];
      const baseYamlObj = YAML.parse(base.yaml);

      const yamlObj = buildYamlObject(baseYamlObj, customColors, {
        name: nameInput.value || 'Custom Theme',
        author: authorInput.value || 'Unknown',
        description: '',
      });

      const yamlStr = YAML.stringify(yamlObj, { indent: 2, lineWidth: 0 });
      const blob = new Blob([yamlStr], { type: 'text/yaml' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = slugify(nameInput.value || 'custom-theme') + '.yaml';
      a.click();
      URL.revokeObjectURL(url);
    });

    // ── Drag-and-drop YAML import ────────────────────────
    const dropOverlay = document.getElementById('drop-overlay')!;
    let dragCounter = 0;

    document.addEventListener('dragenter', (e) => {
      e.preventDefault();
      dragCounter++;
      if (dragCounter === 1) dropOverlay.classList.add('visible');
    });

    document.addEventListener('dragleave', (e) => {
      e.preventDefault();
      dragCounter--;
      if (dragCounter === 0) dropOverlay.classList.remove('visible');
    });

    document.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    document.addEventListener('drop', async (e) => {
      e.preventDefault();
      dragCounter = 0;
      dropOverlay.classList.remove('visible');

      const file = e.dataTransfer?.files[0];
      if (!file || !/\.ya?ml$/i.test(file.name)) return;

      try {
        const text = await file.text();
        const yamlObj = YAML.parse(text);

        if (!yamlObj || !yamlObj.ui) {
          console.warn('Invalid theme YAML: missing ui section');
          return;
        }

        const base = themes.find((t: any) => t.id === baseThemeId) || themes[0];
        const importedColors = flatColorsFromYaml(yamlObj);
        customColors = { ...base.colors, ...importedColors };

        editMode = true;
        ideFrame.classList.add('is-editing');
        buttons.forEach(b => b.classList.remove('active'));
        customSidebarBtn.classList.add('active');

        nameInput.value = yamlObj.name || file.name.replace(/\.ya?ml$/i, '');
        authorInput.value = yamlObj.author || 'Imported';

        updateAllSwatchInputs();
        applyCustomTheme();
      } catch (err) {
        console.error('Failed to parse YAML:', err);
      }
    });
  });
</script>

<style>
  .themes-page {
    padding: 48px 40px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .ide-frame {
    border: 1px solid var(--border);
    border-radius: var(--r-lg);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: calc(100vh - 160px);
    min-height: 500px;
    background: var(--bg-deep);
  }

  /* ── Toolbar ────────────────────────────────────────────── */
  .toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    height: 40px;
    background: var(--bg-raised);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
  }

  .toolbar-title {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--syn-function);
  }

  .toolbar-count {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--fg-muted);
  }

  /* ── IDE body ───────────────────────────────────────────── */
  .ide-body {
    display: flex;
    flex: 1;
    min-height: 0;
  }

  /* ── Sidebar ────────────────────────────────────────────── */
  .sidebar {
    width: 200px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    background: var(--theme-sidebar-bg, var(--bg));
    border-right: 1px solid var(--border);
    overflow-y: auto;
    padding: 8px 0;
    transition: background var(--duration-normal) var(--ease-out);
  }

  .sidebar-file {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 6px 12px;
    border: none;
    background: none;
    color: var(--theme-gutter-fg, var(--fg-muted));
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    cursor: pointer;
    text-align: left;
    border-left: 2px solid transparent;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .sidebar-file:hover {
    color: var(--theme-fg, var(--fg));
    background: color-mix(in srgb, var(--theme-fg, var(--fg)) 8%, var(--theme-sidebar-bg, var(--bg)));
  }

  .sidebar-file.active {
    color: var(--theme-fg, var(--fg-bright));
    background: color-mix(in srgb, var(--theme-fg, var(--fg)) 12%, var(--theme-sidebar-bg, var(--bg)));
    border-left-color: var(--theme-keyword, var(--syn-keyword));
  }

  .file-icon {
    flex-shrink: 0;
    opacity: 0.5;
  }

  .sidebar-file.active .file-icon {
    opacity: 1;
    color: var(--theme-keyword, var(--syn-keyword));
  }

  .file-name {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .sidebar-spacer {
    flex: 1;
  }

  .sidebar-new-theme {
    display: flex;
    align-items: center;
    gap: 8px;
    width: calc(100% - 16px);
    margin: 8px;
    padding: 6px 12px;
    border: 1px dashed var(--border);
    border-radius: 4px;
    background: none;
    color: var(--fg-muted);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .sidebar-new-theme:hover {
    color: var(--fg);
    border-color: var(--fg-muted);
    background: color-mix(in srgb, var(--fg) 5%, transparent);
  }

  .ide-frame.is-editing .sidebar-new-theme {
    display: none;
  }

  .ide-frame.is-editing .sidebar-custom {
    display: flex !important;
  }

  /* ── Splitter ─────────────────────────────────────────── */
  .splitter {
    width: 3px;
    flex-shrink: 0;
    background: var(--theme-splitter-bg, var(--border));
    cursor: col-resize;
    transition: background var(--duration-normal) var(--ease-out);
  }

  /* ── Editor area (tabs + editor) ────────────────────────── */
  .editor-area {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
  }

  /* ── Tab bar ────────────────────────────────────────────── */
  .tab-bar {
    display: flex;
    align-items: flex-end;
    height: 36px;
    background: var(--theme-tab-bar-bg, var(--bg-raised));
    border-bottom: 1px solid var(--theme-tab-bar-border, var(--border));
    flex-shrink: 0;
    padding: 0 8px;
    gap: 1px;
    transition: background var(--duration-normal) var(--ease-out),
                border-color var(--duration-normal) var(--ease-out);
  }

  .tab {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    font-family: var(--font-mono);
    font-size: 11px;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    user-select: none;
    background: var(--theme-tab-bar-inactive-bg, var(--bg-raised));
    color: var(--theme-tab-bar-inactive-fg, var(--fg-muted));
    transition: background var(--duration-normal) var(--ease-out),
                color var(--duration-normal) var(--ease-out);
  }

  .tab.active {
    background: var(--theme-tab-bar-active-bg, var(--bg));
    color: var(--theme-tab-bar-active-fg, var(--fg-bright));
  }

  .tab-modified {
    font-size: 8px;
    opacity: 0.7;
  }

  /* ── Editor pane ────────────────────────────────────────── */
  .editor-pane {
    flex: 1;
    min-width: 0;
    display: flex;
    overflow: hidden;
    background: var(--theme-bg, var(--bg));
    transition: background var(--duration-normal) var(--ease-out);
  }

  .editor-pane-yaml {
    overflow: auto;
  }

  .editor-gutter {
    display: flex;
    flex-direction: column;
    padding: 16px 12px 16px 16px;
    text-align: right;
    user-select: none;
    background: var(--theme-gutter-bg, var(--bg));
    transition: background var(--duration-normal) var(--ease-out);
  }

  .line-num {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    line-height: 1.5;
    color: var(--theme-gutter-fg, var(--fg-muted));
    transition: color var(--duration-normal) var(--ease-out);
  }

  .line-num.active {
    color: var(--theme-gutter-fg-active, var(--fg-bright));
  }

  .editor-gutter-border {
    width: 1px;
    flex-shrink: 0;
    background: var(--theme-gutter-border, var(--border));
    transition: background var(--duration-normal) var(--ease-out);
  }

  .editor-code-wrap {
    flex: 1;
    position: relative;
    min-width: 0;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    line-height: 1.5;
  }

  .editor-code {
    position: relative;
    z-index: 1;
    padding: 16px;
    margin: 0;
    font: inherit;
    color: var(--theme-fg, var(--fg));
    white-space: pre;
    transition: color var(--duration-normal) var(--ease-out);
  }

  /* YAML pane — selectable, no decorations */
  .editor-pane-yaml .editor-code {
    user-select: text;
    cursor: text;
  }

  .editor-pane-yaml .editor-code-wrap {
    overflow: visible;
  }

  .editor-pane-yaml .editor-code-wrap::before {
    display: none;
  }

  /* Line numbers injected via JS need :global since they lack Astro's scoping attribute */
  .editor-pane-yaml :global(.line-num) {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    line-height: 1.5;
    color: var(--theme-gutter-fg, var(--fg-muted));
  }

  /* Current line highlight — line 7 (0-indexed 6) */
  .editor-code-wrap::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: calc(16px + 17lh);
    height: 1lh;
    background: var(--theme-current-line, var(--bg-hover));
    pointer-events: none;
    z-index: 0;
    transition: background var(--duration-normal) var(--ease-out);
  }

  /* Cursor — blinking bar on line 7 */
  .editor-cursor {
    position: absolute;
    width: 2px;
    height: 1lh;
    top: calc(16px + 17lh);
    left: calc(16px + 38ch);
    background: var(--theme-cursor, var(--fg-bright));
    pointer-events: none;
    animation: cursor-blink 1s step-end infinite;
    transition: background var(--duration-normal) var(--ease-out);
  }

  @keyframes cursor-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* Selection uses the theme's selection color, text keeps syntax color */
  .editor-code ::selection,
  .editor-code :global(span)::selection {
    background: color-mix(in srgb, var(--theme-selection, var(--syn-keyword)) 60%, transparent);
    color: inherit;
  }

  .editor-code :global(.kw) { color: var(--theme-keyword, var(--syn-keyword)); }
  .editor-code :global(.fn) { color: var(--theme-function, var(--syn-function)); }
  .editor-code :global(.ty) { color: var(--theme-type, var(--syn-type)); }
  .editor-code :global(.st) { color: var(--theme-string, var(--syn-string)); }
  .editor-code :global(.nm) { color: var(--theme-number, var(--syn-number)); }
  .editor-code :global(.cm) { color: var(--theme-comment, var(--syn-comment)); }
  .editor-code :global(.vr) { color: var(--theme-variable, var(--syn-variable)); }
  .editor-code :global(.op) { color: var(--theme-operator, var(--syn-operator)); }
  .editor-code :global(.ct) { color: var(--theme-constant, var(--syn-constant)); }
  .editor-code :global(.pn) { color: var(--theme-punctuation, var(--syn-punctuation)); }

  /* ── Detail pane ────────────────────────────────────────── */
  .detail-pane {
    width: 320px;
    flex-shrink: 0;
    background: var(--bg);
    border-left: 1px solid var(--border);
    overflow-y: auto;
    padding: 20px;
  }

  .detail-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 4px;
  }

  .detail-name {
    font-family: var(--font-sans);
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--fg-bright);
    letter-spacing: -0.02em;
  }

  .detail-badge {
    font-family: var(--font-mono);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 2px 8px;
    border-radius: var(--r-full);
    background: var(--bg-active);
    color: var(--fg-muted);
    border: 1px solid var(--border);
  }

  .detail-author {
    font-size: var(--text-xs);
    color: var(--fg-muted);
    margin-bottom: 8px;
  }

  .detail-desc {
    font-size: var(--text-sm);
    color: var(--fg-dim);
    line-height: 1.5;
    margin-bottom: 24px;
  }

  /* ── Swatch sections ────────────────────────────────────── */
  .swatch-section {
    margin-bottom: 20px;
  }

  .swatch-heading {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--syn-string);
    font-weight: 600;
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
  }

  .swatch-grid {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .swatch-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .swatch-dot {
    display: block;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    flex-shrink: 0;
    border: 1px solid var(--border);
    transition: background var(--duration-fast) var(--ease-out);
  }

  .swatch-label {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--fg-muted);
    flex: 1;
    min-width: 0;
  }

  .swatch-hex {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--fg-dim);
    text-transform: uppercase;
  }

  /* ── Status bar ─────────────────────────────────────────── */
  .statusbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    height: 28px;
    background: var(--theme-status-bg, var(--status-bg));
    border-top: 1px solid var(--border);
    flex-shrink: 0;
    transition: background var(--duration-normal) var(--ease-out);
  }

  .statusbar-left,
  .statusbar-right {
    display: flex;
    align-items: center;
    gap: 0;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--theme-status-fg, var(--fg-muted));
    transition: color var(--duration-normal) var(--ease-out);
  }

  .statusbar-right {
    gap: 0;
  }

  .statusbar-right span:not(.statusbar-sep) {
    padding: 0 8px;
  }

  .statusbar-sep {
    width: 1px;
    height: 14px;
    background: var(--theme-status-fg, var(--fg-muted));
    opacity: 0.4;
    flex-shrink: 0;
  }

  /* ── Edit mode toggling ──────────────────────────────── */
  .detail-editable {
    display: none;
  }

  .ide-frame.is-editing .detail-editable {
    display: flex;
  }

  .ide-frame.is-editing .detail-readonly {
    display: none;
  }

  /* ── Editable inputs ─────────────────────────────────── */
  .detail-name-input {
    font-family: var(--font-sans);
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--fg-bright);
    letter-spacing: -0.02em;
    background: var(--bg-active);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 4px 8px;
    flex: 1;
    min-width: 0;
  }

  .detail-author-input {
    font-size: var(--text-xs);
    color: var(--fg-muted);
    background: var(--bg-active);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 2px 8px;
    margin-bottom: 16px;
    width: 100%;
    font-family: var(--font-mono);
  }

  /* ── Base theme dropdown ─────────────────────────────── */
  .detail-base-theme {
    flex-direction: column;
    gap: 4px;
    margin-bottom: 16px;
  }

  .detail-label {
    font-family: var(--font-mono);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--fg-dim);
  }

  .detail-select {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--fg);
    background: var(--bg-active);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    padding: 4px 8px;
    cursor: pointer;
  }

  /* ── Swatch color picker ─────────────────────────────── */
  .swatch-dot-label {
    position: relative;
    cursor: pointer;
    flex-shrink: 0;
  }

  .swatch-color-input {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    border: none;
    padding: 0;
    pointer-events: none;
  }

  .ide-frame.is-editing .swatch-color-input {
    pointer-events: auto;
  }

  /* ── Swatch hex input ────────────────────────────────── */
  .swatch-hex-input {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--fg-dim);
    text-transform: uppercase;
    background: var(--bg-active);
    border: 1px solid transparent;
    border-radius: var(--r-sm);
    padding: 1px 4px;
    width: 80px;
    transition: border-color var(--duration-fast) var(--ease-out);
  }

  .swatch-hex-input:focus {
    border-color: var(--border);
    outline: none;
  }

  /* ── Action buttons ──────────────────────────────────── */
  .detail-actions {
    flex-direction: column;
    gap: 8px;
    margin-top: 24px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .btn-download {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--syn-keyword);
    color: var(--bg);
    border: none;
    border-radius: var(--r-sm);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    font-weight: 600;
    cursor: pointer;
    transition: opacity var(--duration-fast) var(--ease-out);
  }

  .btn-download:hover {
    opacity: 0.85;
  }

  .btn-exit-edit {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 6px 16px;
    background: none;
    color: var(--fg-muted);
    border: 1px solid var(--border);
    border-radius: var(--r-sm);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .btn-exit-edit:hover {
    color: var(--fg);
    border-color: var(--fg-muted);
  }

  /* ── Drop overlay ────────────────────────────────────── */
  .drop-overlay {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
  }

  .drop-overlay.visible {
    display: flex;
  }

  .drop-overlay-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    color: var(--fg-bright);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    padding: 40px 60px;
    border: 2px dashed var(--fg-muted);
    border-radius: var(--r-lg);
  }

  /* ── Responsive ─────────────────────────────────────────── */
  @media (max-width: 1024px) {
    .detail-pane {
      display: none;
    }

    .sidebar-new-theme {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .themes-page {
      padding: 70px 16px 24px;
    }

    .ide-frame {
      height: calc(100vh - 120px);
    }

    .sidebar {
      width: 160px;
    }
  }

  @media (max-width: 480px) {
    .sidebar {
      width: 120px;
    }
  }

  /* ── Scrollbars ──────────────────────────────────────────── */
  .sidebar,
  .detail-pane,
  .editor-pane-yaml,
  .editor-code-wrap {
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.15) transparent;
  }

  .sidebar::-webkit-scrollbar,
  .detail-pane::-webkit-scrollbar,
  .editor-pane-yaml::-webkit-scrollbar,
  .editor-code-wrap::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .sidebar::-webkit-scrollbar-track,
  .detail-pane::-webkit-scrollbar-track,
  .editor-pane-yaml::-webkit-scrollbar-track,
  .editor-code-wrap::-webkit-scrollbar-track {
    background: transparent;
  }

  .sidebar::-webkit-scrollbar-thumb,
  .detail-pane::-webkit-scrollbar-thumb,
  .editor-pane-yaml::-webkit-scrollbar-thumb,
  .editor-code-wrap::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.15);
    border-radius: 3px;
  }

  .sidebar::-webkit-scrollbar-thumb:hover,
  .detail-pane::-webkit-scrollbar-thumb:hover,
  .editor-pane-yaml::-webkit-scrollbar-thumb:hover,
  .editor-code-wrap::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.25);
  }

  .sidebar::-webkit-scrollbar-corner,
  .detail-pane::-webkit-scrollbar-corner,
  .editor-pane-yaml::-webkit-scrollbar-corner,
  .editor-code-wrap::-webkit-scrollbar-corner {
    background: transparent;
  }
</style>
